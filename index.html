<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Web Builder Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0a0a0a; color: white; overflow: hidden; font-family: sans-serif; }
        .sidebar { transition: transform 0.3s ease; transform: translateX(-110%); }
        .sidebar.open { transform: translateX(0); }
        #preview-frame { background: white; width: 100%; height: 100%; border: none; }
        .loader { border-top-color: #3b82f6; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="p-4 border-b border-zinc-800 flex justify-between items-center bg-zinc-900">
        <div class="font-bold text-xl tracking-tighter">BUILDER.AI</div>
        <div class="flex items-center gap-4">
            <div id="status-indicator" class="text-[10px] uppercase text-zinc-500 flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-zinc-700"></span> Ready
            </div>
            <button onclick="publishSite()" class="bg-blue-600 hover:bg-blue-500 text-white px-5 py-2 rounded-full text-sm font-bold transition">Publish</button>
        </div>
    </header>

    <main class="flex-grow p-4 relative bg-zinc-950">
        <div class="w-full h-full rounded-xl overflow-hidden border border-zinc-800 shadow-2xl relative bg-white">
            <iframe id="preview-frame"></iframe>
            
            <div id="loading-overlay" class="hidden absolute inset-0 bg-black/80 backdrop-blur-md flex flex-col items-center justify-center z-50">
                <div class="loader w-12 h-12 border-4 border-zinc-700 rounded-full mb-4"></div>
                <p class="text-blue-400 font-mono text-sm animate-pulse">AI is writing code...</p>
            </div>
        </div>
    </main>

    <footer class="p-4 bg-zinc-900 border-t border-zinc-800">
        <div class="max-w-4xl mx-auto flex gap-4 items-center">
            <button onclick="toggleSettings()" class="p-3 bg-zinc-800 hover:bg-zinc-700 rounded-xl transition" title="Settings">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
            
            <input type="text" id="user-prompt" placeholder="Describe the website you want..." 
                   class="flex-grow bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-4 text-white outline-none focus:ring-2 focus:ring-blue-500">
            
            <button onclick="handleGeneration()" class="bg-white text-black font-bold px-8 py-4 rounded-xl hover:bg-zinc-200 transition">Generate</button>
        </div>
    </footer>

    <div id="settings-sidebar" class="sidebar fixed bottom-24 left-4 w-80 bg-zinc-900 border border-zinc-800 rounded-2xl p-6 shadow-2xl z-[60]">
        <h3 class="text-lg font-bold mb-4">API Configuration</h3>
        <div class="space-y-4">
            <div>
                <label class="block text-[10px] text-zinc-500 font-bold mb-1 uppercase">OpenRouter API Key</label>
                <input type="password" id="api-key" placeholder="sk-or-v1-..." class="w-full bg-zinc-800 border border-zinc-700 rounded-lg p-3 text-sm outline-none">
            </div>
            <div>
                <label class="block text-[10px] text-zinc-500 font-bold mb-1 uppercase">Model</label>
                <input type="text" id="model-name" value="anthropic/claude-3.5-sonnet" class="w-full bg-zinc-800 border border-zinc-700 rounded-lg p-3 text-sm outline-none">
            </div>
            <p class="text-[10px] text-zinc-500 leading-relaxed">Ensure your API key has credits. If it fails, check the browser console (F12).</p>
            <button onclick="toggleSettings()" class="w-full bg-zinc-700 py-3 rounded-lg text-sm font-bold">Close Settings</button>
        </div>
    </div>

    <script>
        const ui = {
            prompt: () => document.getElementById('user-prompt'),
            apiKey: () => document.getElementById('api-key'),
            model: () => document.getElementById('model-name'),
            frame: () => document.getElementById('preview-frame'),
            loader: () => document.getElementById('loading-overlay'),
            sidebar: () => document.getElementById('settings-sidebar')
        };

        function toggleSettings() {
            ui.sidebar().classList.toggle('open');
        }

        async function handleGeneration() {
            const prompt = ui.prompt().value;
            const key = ui.apiKey().value;
            const model = ui.model().value;

            if (!prompt || !key) {
                alert("Please enter both a prompt and your API Key in Settings.");
                if(!key) toggleSettings();
                return;
            }

            ui.loader().classList.remove('hidden');

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${key.trim()}`,
                        "X-Title": "AI Website Builder"
                    },
                    body: JSON.stringify({
                        "model": model,
                        "messages": [
                            {
                                "role": "system",
                                "content": "You are an expert web developer. Return ONLY valid HTML code using Tailwind CSS via CDN. Do not include markdown code blocks like ```html. Start directly with <!DOCTYPE html>."
                            },
                            {
                                "role": "user",
                                "content": `Build me a modern, professional website for: ${prompt}. Use high quality placeholder images from Unsplash.`
                            }
                        ]
                    })
                });

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message || "API Error");
                }

                let cleanHTML = data.choices[0].message.content;
                // Remove Markdown markers if the AI still includes them
                cleanHTML = cleanHTML.replace(/```html/gi, "").replace(/```/g, "").trim();

                ui.frame().srcdoc = cleanHTML;
                document.getElementById('status-indicator').innerHTML = '<span class="w-2 h-2 rounded-full bg-green-500"></span> Generated';

            } catch (err) {
                console.error(err);
                alert("Generation failed: " + err.message);
            } finally {
                ui.loader().classList.add('hidden');
            }
        }

        function publishSite() {
            const currentHTML = ui.frame().srcdoc;
            if (!currentHTML || currentHTML.length < 50) {
                alert("Generate a website first!");
                return;
            }
            const name = prompt("Enter a name for your website:");
            if (name) {
                alert(`Publishing "${name}"... \n\nIn this version, your site code has been optimized for deployment. In a full app, this would now connect to Netlify/Vercel.`);
                console.log("Ready to deploy:", currentHTML);
            }
        }
    </script>
</body>
</html>
